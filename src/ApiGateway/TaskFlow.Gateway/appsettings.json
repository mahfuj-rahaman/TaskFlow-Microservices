{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp": "Information"
    }
  },
  "AllowedHosts": "*",

  // =============================================================================
  // üéØ INFRASTRUCTURE ARCHITECTURE CONFIGURATION (Single Source of Truth)
  // =============================================================================
  // This section defines the messaging and event bus technologies used across
  // the entire microservices architecture. Downstream services should read these
  // settings to avoid conflicts and ensure consistency.
  // =============================================================================

  "Infrastructure": {
    // -------------------------------------------------------------------------
    // Messaging Technology Selection
    // -------------------------------------------------------------------------
    // Options: "MassTransit", "Rebus", "MediatR"
    // - MassTransit: Enterprise-grade message bus (RabbitMQ, Azure Service Bus, AWS SQS)
    // - Rebus: Lightweight message bus (RabbitMQ, Azure Service Bus, SQL Server)
    // - MediatR: In-process messaging (for monoliths or testing)
    // -------------------------------------------------------------------------
    "MessagingTechnology": "MassTransit",

    // -------------------------------------------------------------------------
    // EventBus Mode Selection
    // -------------------------------------------------------------------------
    // Options: "InMemory", "Persistent", "Hybrid"
    // - InMemory: Fast, but events lost on crash (good for development)
    // - Persistent: Outbox pattern, guaranteed delivery (good for production)
    // - Hybrid: Both immediate + persistent (recommended for production)
    // -------------------------------------------------------------------------
    "EventBusMode": "Hybrid"
  },

  // =============================================================================
  // üì° MESSAGING CONFIGURATION (MassTransit with Multi-Cloud Support)
  // =============================================================================
  "Messaging": {
    "Provider": "RabbitMQ",
    "Host": "rabbitmq",
    "Port": 5672,
    "VirtualHost": "/",
    "Username": "guest",
    "Password": "guest",
    "Retry": {
      "RetryCount": 3,
      "InitialIntervalSeconds": 5,
      "IntervalIncrementSeconds": 5
    },
    "Outbox": {
      "Enabled": true,
      "QueryDelay": 100,
      "QueryLimit": 100
    },
    "UseMessageScheduler": true
  },

  // =============================================================================
  // üîç SERVICE DISCOVERY (Consul)
  // =============================================================================
  "Consul": {
    "Host": "http://consul:8500",
    "ServiceName": "api-gateway",
    "ServiceId": "api-gateway-1",
    "ServiceAddress": "http://api-gateway",
    "ServicePort": 80,
    "HealthCheckInterval": "00:00:10",
    "DeregisterAfter": "00:01:00"
  },

  // =============================================================================
  // üåê REVERSE PROXY & SERVICE ROUTING (YARP)
  // =============================================================================
  "ReverseProxy": {
    "Routes": {
      // -----------------------------------------------------------------------
      // User Service Routes
      // -----------------------------------------------------------------------
      "user-route": {
        "ClusterId": "user-service",
        "Match": {
          "Path": "/api/v1/users/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/users/{**catch-all}"
          }
        ]
      },
      // -----------------------------------------------------------------------
      // Identity Service Routes (Authentication & Authorization)
      // -----------------------------------------------------------------------
      "identity-appusers-route": {
        "ClusterId": "identity-service",
        "Match": {
          "Path": "/api/v1/identity/appusers/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/appusers/{**catch-all}"
          }
        ],
        "AuthorizationPolicy": "authenticated"
      },
      "identity-auth-route": {
        "ClusterId": "identity-service",
        "Match": {
          "Path": "/api/v1/auth/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/v1/auth/{**catch-all}"
          }
        ]
      },

      // -----------------------------------------------------------------------
      // Admin Service Routes
      // -----------------------------------------------------------------------
      "admin-route": {
        "ClusterId": "admin-service",
        "Match": {
          "Path": "/api/v1/admin/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{**catch-all}"
          }
        ]
      },

      // -----------------------------------------------------------------------
      // Notification Service Routes
      // -----------------------------------------------------------------------
      "notif-route": {
        "ClusterId": "notif-service",
        "Match": {
          "Path": "/api/v1/notifications/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/{**catch-all}"
          }
        ]
      },

      // -----------------------------------------------------------------------
      // Task Service Routes (if needed)
      // -----------------------------------------------------------------------
      "task-route": {
        "ClusterId": "task-service",
        "Match": {
          "Path": "/api/v1/tasks/{**catch-all}"
        },
        "Transforms": [
          {
            "PathPattern": "/api/tasks/{**catch-all}"
          }
        ]
      }
    },

    // -------------------------------------------------------------------------
    // Service Clusters (Downstream Service Addresses)
    // -------------------------------------------------------------------------
    "Clusters": {
      "user-service": {
        "Destinations": {
          "primary": {
            "Address": "http://user-service:8080"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:10",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },

      "admin-service": {
        "Destinations": {
          "primary": {
            "Address": "http://admin-service:8080"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:10",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },

      "notif-service": {
        "Destinations": {
          "primary": {
            "Address": "http://notif-service:8080"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:10",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },

      "task-service": {
        "Destinations": {
          "primary": {
            "Address": "http://task-service:8080"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:10",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },

      "identity-service": {
        "Destinations": {
          "primary": {
            "Address": "http://identity-service:8080"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:10",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        },
        "LoadBalancingPolicy": "RoundRobin"
      }
    }
  },

  // =============================================================================
  // üîê JWT AUTHENTICATION
  // =============================================================================
  "JwtSettings": {
    "SecretKey": "TaskFlow-Super-Secret-Key-Change-In-Production-Min-32-Chars!!!",
    "Issuer": "TaskFlow.ApiGateway",
    "Audience": "TaskFlow.Services",
    "ExpirationMinutes": 15,
    "RefreshTokenExpirationDays": 7,
    "ValidateIssuer": true,
    "ValidateAudience": true,
    "ValidateLifetime": true,
    "ValidateIssuerSigningKey": true,
    "ClockSkew": "00:05:00"
  },

  // =============================================================================
  // üîê CORS CONFIGURATION
  // =============================================================================
  "Cors": {
    "AllowedOrigins": [ "http://localhost:3000", "http://localhost:5173", "https://taskflow.com" ],
    "AllowedMethods": [ "GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS" ],
    "AllowedHeaders": [ "Content-Type", "Authorization", "X-Requested-With", "X-Request-Id", "X-Correlation-Id" ],
    "AllowCredentials": true,
    "ExposedHeaders": [ "X-Request-Id", "X-Correlation-Id" ]
  },

  // =============================================================================
  // üõ°Ô∏è RATE LIMITING
  // =============================================================================
  "RateLimiting": {
    "Enabled": true,
    "PermitLimit": 100,
    "Window": "00:01:00",
    "QueueLimit": 10
  },

  // =============================================================================
  // üìä DISTRIBUTED TRACING (Jaeger)
  // =============================================================================
  "Jaeger": {
    "AgentHost": "jaeger",
    "AgentPort": 6831,
    "ServiceName": "api-gateway"
  },

  // =============================================================================
  // üìù LOGGING (Seq)
  // =============================================================================
  "Seq": {
    "ServerUrl": "http://seq:5341",
    "ApiKey": ""
  }
}
